<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dms.exhibit">
	
	<select id="getExhibitId" resultType="baseDmsExhibit">
		/* [dms.exhibit.getExhibitId][ian][2016. 04. 20.] */
		SELECT NVL(MAX(EXHIBIT_ID), 0) +1 AS EXHIBIT_ID FROM DMS_EXHIBIT
	</select>
	
	<select id="getAllExhibitList" resultType="DmsExhibit">
		/* [dms.exhibit.getAllExhibitList][allen][2016. 11. 20.] */
		SELECT EXHIBIT_ID, CONTROL_NO
		  FROM DMS_EXHIBIT
		 WHERE SYSDATE BETWEEN START_DT AND END_DT
		   AND EXHIBIT_STATE_CD = 'EXHIBIT_STATE_CD.RUN'
		   AND DISPLAY_YN = 'Y'
	</select>
	
	<select id="getExhibitList" resultType="dmsExhibit" parameterType="dmsExhibitSearch">
		/* [dms.exhibit.getExhibitList][allen][2016. 05. 23.] */
		<include refid="ccs.common.pagingPre" />
		SELECT DISTINCT
				  T1.STORE_ID
				, T1.EXHIBIT_ID
				, T1.NAME
				, T1.SUBTITLE
				, T1.EXHIBIT_TYPE_CD 
				, T1.CONTROL_NO
				, T1.START_DT
				, T1.END_DT
				, T1.DAYS_WEEK
				, T1.IMG1
				, T1.IMG2
				, T1.TEXT1
				, T1.TEXT2
				, T1.HTML1
				, T1.HTML2
				, T1.SUB_HTML1
				, T1.SUB_HTML2
				, T1.EXHIBIT_STATE_CD
				, T1.DISPLAY_YN
				, T1.SORT_NO
				, T1.INS_DT
				, T1.INS_ID
				, T1.UPD_ID
				, (SELECT NAME  FROM CCS_USER WHERE USER_ID = T1.INS_ID) INS_NAME 
				, T1.UPD_DT
				, (SELECT NAME  FROM CCS_USER WHERE USER_ID = T1.UPD_ID) UPD_NAME
		  FROM DMS_EXHIBIT T1
		  LEFT JOIN DMS_EXHIBITPRODUCT T2
            ON T1.EXHIBIT_ID = T2.EXHIBIT_ID
          LEFT JOIN PMS_PRODUCT T3
            ON T2.PRODUCT_ID = T3.PRODUCT_ID 
		 WHERE T1.STORE_ID = #{storeId}
			 <if test="exhibitStateCds != null and exhibitStateCds != ''">
			 	AND T1.EXHIBIT_STATE_CD IN (${exhibitStateCds})
			 </if>
			 <if test="exhibitTypeCds != null and exhibitTypeCds != ''">
			 	AND T1.EXHIBIT_TYPE_CD IN (${exhibitTypeCds})
			 </if>
	      	 <if test="startDate != null and startDate != ''">
	      	 	<if test="endDate != null and endDate != ''">
					AND ( T1.START_DT <![CDATA[<=]]> TO_DATE (#{endDate}, 'YYYY-MM-DD HH24:MI:SS') 
					AND T1.END_DT <![CDATA[>=]]> TO_DATE (#{startDate}, 'YYYY-MM-DD HH24:MI:SS') )
				</if>
     	 	</if>
     	 	<if test="productInfoType != null and productInfoType == 'NAME'">
				<if test="productSearchKeyword != null and productSearchKeyword != ''">
					AND T3.NAME LIKE '%' || #{productSearchKeyword} || '%'
				</if>
			</if>
			<if test="productInfoType != null and productInfoType == 'PRODUCTID'">
				<if test="productSearchKeyword != null and productSearchKeyword != ''">
					AND T2.PRODUCT_ID = #{productSearchKeyword}
				</if>		
			</if>
     	 	<if test="exhibitInfoType != null and exhibitInfoType == 'NAME'">
				<if test="exhibitSearchKeyword != null and exhibitSearchKeyword != ''">
					AND T1.NAME LIKE '%' || #{exhibitSearchKeyword} || '%'
				</if>
			</if>
			<if test="exhibitInfoType != null and exhibitInfoType == 'EXHIBITID'">
				<if test="exhibitSearchKeyword != null and exhibitSearchKeyword != ''">
					AND T1.EXHIBIT_ID = #{exhibitSearchKeyword}
				</if>		
			</if>
      	 ORDER BY T1.SORT_NO, T1.INS_DT DESC
		<include refid="ccs.common.pagingPost" />
	</select>
	
	
	<resultMap type="DmsExhibitproduct" id="exhibitProductMap" autoMapping="true">
		<id property="storeId" column="STORE_ID" />
		<id property="exhibitId" column="EXHIBIT_ID" />
		<id property="groupNo" column="GROUP_NO" />
		<id property="productId" column="PRODUCT_ID" />
		<result property="displayYn" column="DISPLAY_YN" />
		<result property="sortNo" column="SORT_NO" />
		   	<association property="pmsProduct" column="PRODUCT_ID" javaType="pmsProduct">
		   		<id property="productId" column="PRODUCT_ID" />
		   		<result property="name" column="NAME" />
		   		<result property="productTypeCd" column="PRODUCT_TYPE_CD" />
		   		<result property="saleStateCd" column="SALE_STATE_CD" />
		   		<result property="salePrice" column="SALE_PRICE" />
		   		<result property="brandName" column="BRAND_NAME" />
		   	</association>
	   </resultMap>
	
	
	
	<select id="getExhibitProductList" parameterType="dmsExhibitSearch" resultMap="exhibitProductMap">
	/* [dms.exhibit.getExhibitProductList][allen][2016. 05. 27.] */
		<include refid="ccs.common.pagingPre" />
		SELECT 
				EPRD.*
              , PRD.NAME
              , PRD.PRODUCT_TYPE_CD
              , PRD.SALE_STATE_CD
              , PRD.SALE_PRICE
             , (SELECT NAME FROM PMS_BRAND WHERE BRAND_ID = PRD.BRAND_ID) AS BRAND_NAME
             ,(SELECT US.NAME FROM CCS_USER US WHERE EPRD.INS_ID = US.USER_ID AND ROWNUM=1) AS INS_NAME
			 ,(SELECT US.NAME FROM CCS_USER US WHERE EPRD.UPD_ID = US.USER_ID AND ROWNUM=1) AS UPD_NAME
          FROM DMS_EXHIBITGROUP GRP
          JOIN DMS_EXHIBITPRODUCT EPRD
            ON GRP.EXHIBIT_ID = EPRD.EXHIBIT_ID
           AND GRP.GROUP_NO = EPRD.GROUP_NO 
          JOIN PMS_PRODUCT PRD 
            ON EPRD.PRODUCT_ID = PRD.PRODUCT_ID
         WHERE GRP.EXHIBIT_ID = #{exhibitId}
           AND EPRD.GROUP_NO = #{groupNo}
           ORDER BY EPRD.SORT_NO
        <include refid="ccs.common.pagingPost" />
	</select>
	
	
	<select id="getExistsExhibitProduct" resultType="dmsExhibitproduct">
	/* [dms.exhibit.getExistsExhibitProduct][allen][2016. 05. 27.] */
	   SELECT PRD.PRODUCT_ID 
         FROM DMS_EXHIBITGROUP GRP
         JOIN DMS_EXHIBITPRODUCT PRD
           ON GRP.EXHIBIT_ID = prd.EXHIBIT_ID
         WHERE GRP.EXHIBIT_ID = #{exhibitId}
           AND PRD.GROUP_NO = #{groupNo}
           <if test="productIds != null and productIds.length > 0">
	           AND PRD.PRODUCT_ID IN 
	           <foreach collection="productIds" item="productId" open="(" separator=","  close=")">
	           		#{productId}
	           </foreach>
           </if>  
	</select>
	
	<select id="getExistsExhibitCoupon" resultType="dmsExhibitcoupon">
	/* [dms.exhibit.getExistsExhibitCoupon][allen][2016. 05. 27.] */
	   SELECT COUPON_ID 
         FROM DMS_EXHIBITCOUPON 
         WHERE STORE_ID = #{storeId} 
           AND EXHIBIT_ID = #{exhibitId}
           <if test="couponIds != null and couponIds.length > 0">
	           AND COUPON_ID IN 
	           <foreach collection="couponIds" item="couponId" open="(" separator=","  close=")">
	           		#{couponId}
	           </foreach>
           </if>  
	</select>
	
	<select id="getExhibitGroupList" resultType="dmsExhibitgroup">
		/* [display.getExhibitGroupList][allen][2016. 05. 26.] */
		 <include refid="ccs.common.pagingPre" />
		SELECT
				  STORE_ID
				, EXHIBIT_ID
				, GROUP_NO
				, GROUP_TYPE_CD
				, NAME
				, IMG
				, URL1
				, URL2
				, PRODUCT_DISPLAY_TYPE1_CD
				, PRODUCT_DISPLAY_TYPE2_CD
				, SORT_NO
				, DISPLAY_YN
				, INS_DT
				, INS_ID
				, UPD_DT
				, UPD_ID
				,(SELECT US.NAME FROM CCS_USER US WHERE DMS_EXHIBITGROUP.INS_ID = US.USER_ID AND ROWNUM=1) AS INS_NAME
			  	,(SELECT US.NAME FROM CCS_USER US WHERE DMS_EXHIBITGROUP.UPD_ID = US.USER_ID AND ROWNUM=1) AS UPD_NAME
		  FROM DMS_EXHIBITGROUP
		  WHERE EXHIBIT_ID = #{exhibitId}
		  <include refid="ccs.common.pagingPost" />
	</select>
	
	
	<insert id="insertExhibit">
		<selectKey keyProperty="exhibitId" resultType="String" order="BEFORE">
		/* [dms.exhibit.insertExhibit][allen][2016.06.07] */
		SELECT NVL (EXHIBIT_ID, 1) exhibitId
		  FROM (SELECT MAX (TO_NUMBER (EXHIBIT_ID)) + 1 EXHIBIT_ID FROM DMS_EXHIBIT WHERE STORE_ID= #{storeId}) DUAL
		</selectKey>	
		INSERT INTO DMS_EXHIBIT (
   								  STORE_ID
   								, EXHIBIT_ID
   								, NAME
   								, SUBTITLE
   								, EXHIBIT_TYPE_CD
   								, CONTROL_NO
   								, START_DT
   								, END_DT
   								, DAYS_WEEK
   								, IMG1
   								, IMG2
   								, TEXT1
   								, TEXT2
   								, HTML1
   								, HTML2
   								, EXHIBIT_STATE_CD
   								, DISPLAY_YN
   								, SORT_NO
   								, INS_DT
   								, INS_ID
   								, UPD_DT
   								, UPD_ID) 
						VALUES (   #{storeId, jdbcType=VARCHAR}
								 , #{exhibitId, jdbcType=VARCHAR}
								 , #{name, jdbcType=VARCHAR}
								 , #{subtitle, jdbcType=VARCHAR}
								 , #{exhibitTypeCd, jdbcType=VARCHAR}
								 , #{controlNo, jdbcType=NUMERIC}
								 , #{startDt, jdbcType=TIMESTAMP}
								 , #{endDt, jdbcType=TIMESTAMP}
								 , #{daysWeek, jdbcType=VARCHAR}
								 , #{img1, jdbcType=VARCHAR}
								 , #{img2, jdbcType=VARCHAR}
								 , #{text1, jdbcType=VARCHAR}
								 , #{text2, jdbcType=VARCHAR}
								 , #{html1, jdbcType=VARCHAR}
								 , #{html2, jdbcType=VARCHAR}
								 , #{exhibitStateCd, jdbcType=VARCHAR}
								 , #{displayYn, jdbcType=VARCHAR}
								 , #{sortNo, jdbcType=NUMERIC}
								 , SYSDATE
								 , #{insId, jdbcType=VARCHAR}
								 , SYSDATE
								 , #{updId, jdbcType=VARCHAR} )
		
	</insert>
	
	<resultMap type="DmsExhibit" id="exhibitDetailMap">
		<id property="exhibitId" column="EXHIBIT_ID" />
		<result property="name" column="NAME" />
		<result property="subtitle" column="SUBTITLE" />
		<result property="sortNo" column="SORT_NO" />
		<result property="exhibitTypeCd" column="EXHIBIT_TYPE_CD" />
		<result property="exhibitStateCd" column="EXHIBIT_STATE_CD" />
		<result property="startDt" column="START_DT" />
		<result property="endDt" column="END_DT" />
		<result property="daysWeek" column="DAYS_WEEK" />
		<result property="displayYn" column="DISPLAY_YN" />
		<result property="img1" column="IMG1" />
		<result property="img2" column="IMG2" />
		<result property="text1" column="TEXT1" />
		<result property="text2" column="TEXT2" />
		<result property="html1" column="HTML1" />
		<result property="html2" column="HTML2" />
		<result property="subHtml1" column="SUB_HTML1" />
		<result property="subHtml2" column="SUB_HTML2" />
		<result property="controlNo" column="CONTROL_NO" />
		<result property="restrictYn" column="RESTRICTYN" />
	   	<association property="ccsControl" column="CONTROL_NO" javaType="ccsControl">
	    	<id property="controlNo" column="CONTROL_NO" />
	    	<result property="memTypeControlCd" column="MEM_TYPE_CONTROL_CD"/>
	    	<result property="memGradeControlCd" column="MEM_GRADE_CONTROL_CD"/>
	    	<result property="channelControlCd" column="CHANNEL_CONTROL_CD"/>
	    	<result property="deviceControlCd" column="DEVICE_CONTROL_CD"/>
			
			<collection property="ccsControlmembertypes" ofType="gcp.ccs.model.CcsControlmembertype">
				<result property="controlNo" column="CONTROL_NO" />
				<result property="memberTypeCd" column="MEMBER_TYPE_CD" />
			</collection>
				    
			<collection property="ccsControlmembergrades" ofType="gcp.ccs.model.CcsControlmembergrade">
				<result property="controlNo" column="CONTROL_NO" />
				<result property="memGradeCd" column="MEMBER_TYPE_CD" />
			</collection>
				    
			<collection property="ccsControlchannels" ofType="gcp.ccs.model.CcsControlchannel">
				<result property="controlNo" column="CONTROL_NO" />
				<result property="channelId" column="CHANNEL_ID" />
			</collection>
				    
			<collection property="ccsControldevices" ofType="gcp.ccs.model.CcsControldevice">
				<result property="controlNo" column="CONTROL_NO" />
				<result property="deviceTypeCd" column="DEVICE_TYPE_CD" />
			</collection>	    
	    </association>
		<collection property="dmsExhibitdisplaycategorys" ofType="gcp.dms.model.DmsExhibitdisplaycategory" >
	    	<result property="storeId" column="STORE_ID"/>
	    	<result property="exhibitId" column="EXHIBIT_ID"/>
	    	<result property="displayCategoryId" column="DISPLAY_CATEGORY_ID"/>
	    	<result property="displayCategoryName" column="DISPLAY_CATEGORY_NAME"/>
	    </collection>
		<collection property="dmsExhibitbrands" ofType="gcp.dms.model.DmsExhibitbrand" >
	    	<result property="storeId" column="STORE_ID"/>
	    	<result property="exhibitId" column="EXHIBIT_ID"/>
	    	<result property="brandId" column="BRAND_ID"/>
	    	<result property="brandName" column="BRAND_NAME"/>
	    </collection>
	</resultMap>
	
	<select id="getExhibitDetail" parameterType="baseDmsExhibit" resultMap="exhibitDetailMap">
		/* [dms.exhibit.getExhibitDetail][allen][2016.06.07] */
		SELECT 
				  T1.EXHIBIT_ID
				, T1.NAME
				, T1.SUBTITLE
				, T1.SORT_NO
				, T1.EXHIBIT_TYPE_CD
				, T1.EXHIBIT_STATE_CD
				, T1.START_DT
				, T1.CONTROL_NO
				, T1.END_DT
				, T1.DAYS_WEEK
				, T1.DISPLAY_YN
				, T1.IMG1
				, T1.IMG2
				, T1.TEXT1
				, T1.TEXT2
				, T1.HTML1
				, T1.HTML2
				, T1.SUB_HTML1
				, T1.SUB_HTML2
				, DECODE(T1.CONTROL_NO, NULL, 'N', 'Y') AS RESTRICTYN
				, T2.DISPLAY_CATEGORY_ID
				, T3.BRAND_ID
				, (SELECT NAME FROM DMS_DISPLAYCATEGORY WHERE DISPLAY_CATEGORY_ID = T2.DISPLAY_CATEGORY_ID)AS DISPLAY_CATEGORY_NAME
				, (SELECT NAME FROM PMS_BRAND WHERE BRAND_ID = T3.BRAND_ID) AS BRAND_NAME
				, T4.CHANNEL_CONTROL_CD
				, T5.MEMBER_TYPE_CD
				, T6.MEM_GRADE_CD
				, T7.CHANNEL_ID
				, T8.DEVICE_TYPE_CD
		  FROM DMS_EXHIBIT T1
		  LEFT JOIN DMS_EXHIBITDISPLAYCATEGORY T2
			ON T1.EXHIBIT_ID = T2.EXHIBIT_ID
		  LEFT JOIN DMS_EXHIBITBRAND T3
			ON T1.EXHIBIT_ID = T3.EXHIBIT_ID
		  LEFT JOIN CCS_CONTROL T4
                 ON T1.CONTROL_NO = T4.CONTROL_NO
          LEFT JOIN CCS_CONTROLMEMBERTYPE T5
            	 ON T1.CONTROL_NO = T5.CONTROL_NO
          LEFT JOIN CCS_CONTROLMEMBERGRADE T6
            	 ON T1.CONTROL_NO = T6.CONTROL_NO
          LEFT JOIN CCS_CONTROLCHANNEL T7
            	 ON T1.CONTROL_NO = T7.CONTROL_NO
          LEFT JOIN CCS_CONTROLDEVICE T8
            	 ON T1.CONTROL_NO = T8.CONTROL_NO
		 WHERE T1.STORE_ID = #{storeId}
		   AND T1.EXHIBIT_ID = #{exhibitId}
	</select>
	
	<delete id="deleteExhibitproduct" parameterType="dmsExhibitproduct">
	/* [dms.exhibit.deleteExhibitproduct][allen][2016.06.07] */
		DELETE 
		  FROM DMS_EXHIBITPRODUCT 
		 WHERE STORE_ID = #{storeId}
		   AND EXHIBIT_ID = #{exhibitId} 
		   <if test="groupNo != null">
		   	AND GROUP_NO = #{groupNo}
		   </if>
		   <if test="productId != null and productId != ''">
		   	AND PRODUCT_ID= #{productId}
		   </if>
		   
	</delete>
	
	<delete id="deleteExhibitgroup" parameterType="dmsExhibitgroup">
	/* [dms.exhibit.deleteExhibitgroup][allen][2016.06.07] */
		DELETE 
		  FROM DMS_EXHIBITGROUP 
		 WHERE STORE_ID = #{storeId}
		   AND EXHIBIT_ID = #{exhibitId} 
		   <if test="groupNo != null">
		   	AND GROUP_NO = #{groupNo}
		   </if>
	</delete>
	
	
	
	<resultMap type="dmsExhibitmainproduct" id="mainProductMap" autoMapping="true">
		<id property="exhibitId" column="EXHIBIT_ID" />
		<id property="productId" column="PRODUCT_ID" />
		<result property="name" column="MAIN_PRODUCT_NAME" />
		<result property="img" column="IMG" />
		<result property="sortNo" column="SORT_NO" />
		<result property="insDt" column="INS_DT" />
		<result property="insId" column="INS_ID" />
		<result property="updDt" column="UPD_DT" />
		<result property="updId" column="UPD_ID" />
		<association property="pmsProduct" column="PRODUCT_ID" javaType="pmsProduct">
			<id property="productId" column="PRODUCT_ID" />
			<result property="name" column="PRODUCT_NAME" />
			<result property="adCopy" column="AD_COPY" />
			<result property="productTypeCd" column="PRODUCT_TYPE_CD" />
			<result property="saleStateCd" column="SALE_STATE_CD" />
			<result property="salePrice" column="PRODUCT_SALE_PRICE" />
			<result property="listPrice" column="LIST_PRICE" />
			<result property="brandId" column="BRAND_ID" />
			<result property="brandName" column="BRAND_NAME" />
			<result property="saleStartDt" column="SALE_START_DT" />
			<result property="saleEndDt" column="SALE_END_DT" /> 
			<result property="mainProductImg" column="MAIN_PRODUCT_IMG" />
			<association property="pmsProductprice" column="PRODUCT_ID" javaType="pmsProductprice">
				<id property="productId" 					column="PRODUCT_ID" />
				<result property="salePrice"				column="SALE_PRICE" />
				<result property="pointYn" 					column="POINT_YN" />
				<result property="deliveryFeeFreeYn" 		column="DELIVERY_FEE_FREE_YN" />
				<result property="couponId" 				column="COUPON_ID" />
				<result property="prestigeSalePrice"		column="PRESTIGE_SALE_PRICE" />
				<result property="prestigePointYn"			column="PRESTIGE_POINT_YN" />
				<result property="prestigeDeliveryFeeFreeYn" column="PRESTIGE_DELIVERY_FEE_FREE_YN" />
				<result property="prestigeCouponId"			column="PRESTIGE_COUPON_ID" />
				<result property="vipSalePrice"				column="VIP_SALE_PRICE" />
				<result property="vipPointYn" 				column="VIP_POINT_YN" /> 
				<result property="vipDeliveryFeeFreeYn" 	column="VIP_DELIVERY_FEE_FREE_YN" />
				<result property="vipCouponId" 				column="VIP_COUPON_ID" />
				<result property="goldSalePrice"			column="GOLD_SALE_PRICE" />
				<result property="goldPointYn" 				column="GOLD_POINT_YN" />
				<result property="goldDeliveryFeeFreeYn"	column="GOLD_DELIVERY_FEE_FREE_YN" />
				<result property="goldCouponId"				column="GOLD_COUPON_ID" />
				<result property="silverSalePrice"			column="SILVER_SALE_PRICE" />
				<result property="silverPointYn"			column="SILVER_POINT_YN" />
				<result property="silverDeliveryFeeFreeYn"	column="SILVER_DELIVERY_FEE_FREE_YN" />
				<result property="silverCouponId"			column="SILVER_COUPON_ID" />
				<result property="familySalePrice"			column="FAMILY_SALE_PRICE" />
				<result property="familyPointYn"			column="FAMILY_POINT_YN" />
				<result property="familyDeliveryFeeFreeYn"	column="FAMILY_DELIVERY_FEE_FREE_YN" />
				<result property="familyCouponId"			column="FAMILY_COUPON_ID" />
				<result property="welcomeSalePrice" 		column="WELCOME_SALE_PRICE" />
				<result property="welcomePointYn" 			column="WELCOME_POINT_YN" />
				<result property="welcomeDeliveryFeeFreeYn" column="WELCOME_DELIVERY_FEE_FREE_YN" />
				<result property="welcomeCouponId" 			column="WELCOME_COUPON_ID" />
			</association>
		</association>
	</resultMap>
	
	<select id="getExhibitMainProductList" resultMap="mainProductMap" > 
	/* [dms.exhibit.getExhibitMainProductList][allen][2016.06.07] */
		<include refid="ccs.common.pagingPre" />
		SELECT 
				 T1.EXHIBIT_ID	
		       , T2.PRODUCT_ID
		       , T2.NAME				AS MAIN_PRODUCT_NAME
		       , T2.IMG					
		       , T2.IMG					AS MAIN_PRODUCT_IMG					
		       , T2.SORT_NO
		       , T2.NAME				AS PRODUCT_NAME
		       , T3.AD_COPY
		       , T3.PRODUCT_TYPE_CD
		       , T3.SALE_STATE_CD
		       , T3.LIST_PRICE
		       , T3.SALE_PRICE			AS PRODUCT_SALE_PRICE
		       , T3.BRAND_ID
		       , (SELECT NAME FROM PMS_BRAND WHERE BRAND_ID = T3.BRAND_ID) AS BRAND_NAME
		       , T3.SALE_START_DT
		       , T3.SALE_END_DT
		       , T2.INS_DT
		       , T2.INS_ID
		       , T2.UPD_DT
		       , T2.UPD_ID
			   , (SELECT US.NAME FROM CCS_USER US WHERE T2.INS_ID = US.USER_ID AND ROWNUM=1) AS INS_NAME
		  	   , (SELECT US.NAME FROM CCS_USER US WHERE T2.UPD_ID = US.USER_ID AND ROWNUM=1) AS UPD_NAME
               , T6.SALE_PRICE
			   , T6.POINT_YN
			   , T6.DELIVERY_FEE_FREE_YN
			   , T6.COUPON_ID
			   , T6.PRESTIGE_SALE_PRICE
			   , T6.PRESTIGE_POINT_YN
			   , T6.PRESTIGE_DELIVERY_FEE_FREE_YN
			   , T6.PRESTIGE_COUPON_ID
			   , T6.VIP_SALE_PRICE
			   , T6.VIP_POINT_YN
		 	   , T6.VIP_DELIVERY_FEE_FREE_YN
			   , T6.VIP_COUPON_ID
			   , T6.GOLD_SALE_PRICE
			   , T6.GOLD_POINT_YN
			   , T6.GOLD_DELIVERY_FEE_FREE_YN
			   , T6.GOLD_COUPON_ID
			   , T6.SILVER_SALE_PRICE
			   , T6.SILVER_POINT_YN
			   , T6.SILVER_DELIVERY_FEE_FREE_YN
			   , T6.SILVER_COUPON_ID
			   , T6.FAMILY_SALE_PRICE
			   , T6.FAMILY_POINT_YN
			   , T6.FAMILY_DELIVERY_FEE_FREE_YN
			   , T6.FAMILY_COUPON_ID
			   , T6.WELCOME_SALE_PRICE
			   , T6.WELCOME_POINT_YN
			   , T6.WELCOME_DELIVERY_FEE_FREE_YN
			   , T6.WELCOME_COUPON_ID
		  FROM DMS_EXHIBIT T1
		  JOIN DMS_EXHIBITMAINPRODUCT T2
		    ON T1.EXHIBIT_ID = T2.EXHIBIT_ID
		   AND T1.STORE_ID = T2.STORE_ID
           AND T1.STORE_ID = #{storeId}
           AND T2.STORE_ID = #{storeId}
		  JOIN PMS_PRODUCT T3
		    ON T2.PRODUCT_ID = T3.PRODUCT_ID
		   AND T2.STORE_ID = T3.STORE_ID
           AND T3.STORE_ID = #{storeId}
		  JOIN PMS_CATEGORY T4
               ON T3.CATEGORY_ID = T4.CATEGORY_ID
             JOIN DMS_DISPLAYCATEGORYPRODUCT T5
               ON T3.PRODUCT_ID = T5.PRODUCT_ID
             JOIN PMS_PRODUCTPRICE T6
               ON T3.PRODUCT_ID = T6.PRODUCT_ID
		  WHERE T1.STORE_ID = #{storeId} 
		    AND T1.EXHIBIT_ID = #{exhibitId}
		  ORDER BY T2.SORT_NO 
	<include refid="ccs.common.pagingPost" />
	</select>
	
	<select id="getExhibitCouponList" resultMap="dmsExhibitcouponMap">
		/* [dms.exhibit.getExhibitCouponList][allen][2016.06.07] */
		<include refid="ccs.common.pagingPre" />
		SELECT 
                T1.STORE_ID
              , T1.EXHIBIT_ID
              , T1.COUPON_ID
              , T1.SORT_NO
              , T1.INS_DT
              , T1.INS_ID
              , T1.UPD_DT
              , T1.UPD_ID
              , T2.NAME
              , T2.DC_VALUE
              , T2.DC_APPLY_TYPE_CD
              , T2.COUPON_TYPE_CD
              , T2.MAX_MEM_ISSUE_QTY
              , T2.MIN_ORDER_AMT
              , T2.TERM_TYPE_CD
              , T2.TERM_DAYS
              , T2.TERM_START_DT
              , T2.TERM_END_DT
              , T2.ISSUE_START_DT
              , T2.ISSUE_END_DT
              , T2.COUPON_ISSUE_TYPE_CD
              , T2.MAX_ISSUE_QTY
              , T2.COUPON_STATE_CD
			  ,	T2.DOWN_SHOW_YN
			  ,	T2.MAX_DC_AMT
			  ,	T2.DISCOUNT_DUP_YN
			  ,	T2.CONTROL_NO
			  ,	T2.APPLY_NO
			  ,	T2.BUSINESS_ID
			  ,	T2.BUSINESS_BURDEN_RATE
			  ,	T2.FEE_LIMIT_APPLY_YN
			  ,	T2.AFFILIATE_YN
			  ,	T2.DEAL_APPLY_YN
			  ,	T2.CAMPAIGN_YN
			  ,	T2.MEM_ISSUE_BASIS_CD
              ,(SELECT US.NAME FROM CCS_USER US WHERE T1.INS_ID = US.USER_ID AND ROWNUM=1) AS INS_NAME
			  ,(SELECT US.NAME FROM CCS_USER US WHERE T1.UPD_ID = US.USER_ID AND ROWNUM=1) AS UPD_NAME
			  , T3.TARGET_TYPE_CD
			  , CASE WHEN (T2.MAX_ISSUE_QTY > (SELECT COUNT(*) FROM SPS_COUPONISSUE WHERE STORE_ID = #{storeId} AND COUPON_ID = T2.COUPON_ID))
                     THEN 'N'
                     ELSE 'Y'
                      END AS EXCEED_YN  
         FROM DMS_EXHIBITCOUPON T1
         JOIN SPS_COUPON T2
           ON T1.COUPON_ID = T2.COUPON_ID
         JOIN CCS_APPLY T3
           ON T2.APPLY_NO = T3.APPLY_NO AND T3.STORE_ID = '1001'
        WHERE T1.STORE_ID = #{storeId}
          AND T1.EXHIBIT_ID = #{exhibitId}
           AND SYSDATE BETWEEN T2.ISSUE_START_DT AND T2.ISSUE_END_DT
		   AND T2.COUPON_STATE_CD = 'COUPON_STATE_CD.RUN'
<!-- 		   <if test="system != null and system != ''"> -->
<!-- 		   		<if test="system == 'FO'"> -->
<!-- 		   		AND T2.MAX_ISSUE_QTY > (SELECT COUNT(*) FROM SPS_COUPONISSUE WHERE STORE_ID = #{storeId} AND COUPON_ID = T2.COUPON_ID) -->
<!-- 		   		</if> -->
<!-- 		   </if> -->
		   
        ORDER BY T1.SORT_NO
        <include refid="ccs.common.pagingPost" />
	</select>
	
	
	<select id="getExhibitOffshopList" resultType="ccsOffshop">
		/* [dms.exhibit.getExhibitOffshopList][allen][2016.08.01] */
		<include refid="ccs.common.pagingPre" />
		SELECT 
   				  T4.*
 				, ADDRESS1 ||' '|| ADDRESS2 ||' '|| ADDRESS3 ||' '|| ADDRESS4 AS ADDRESS
 				, (SELECT REPLACE(WM_CONCAT(T2.NAME), ',', ', ') BRAND_NAME from CCS_OFFSHOPBRAND T1 JOIN PMS_BRAND T2 ON T1.BRAND_ID = T2.BRAND_ID WHERE T1.OFFSHOP_ID = T4.OFFSHOP_ID) OFFSHOPBRANDS
 		  FROM DMS_EXHIBITOFFSHOP T1
		  JOIN CCS_OFFSHOP T4
			ON T1.OFFSHOP_ID = T4.OFFSHOP_ID
		 WHERE T1.STORE_ID = #{storeId}
		   AND T1.EXHIBIT_ID = #{exhibitId} 
		<include refid="ccs.common.pagingPost" />
	</select>
	
	<delete id="deleteBatchExhibitMainProduct" parameterType="dmsExhibit">
		/* [dms.exhibit.deleteBatchExhibitMainProduct][allen][2016.06.07] */
		DELETE 
		  FROM DMS_EXHIBITMAINPRODUCT 
		 WHERE STORE_ID = #{storeId}
		   AND EXHIBIT_ID = #{exhibitId} 
	</delete>
	
	<delete id="deleteBatchExhibitCoupon" parameterType="dmsExhibit">
		/* [dms.exhibit.deleteBatchExhibitCoupon][allen][2016.06.07] */
		DELETE 
		  FROM DMS_EXHIBITCOUPON 
		 WHERE STORE_ID = #{storeId}
		   AND EXHIBIT_ID = #{exhibitId} 
	</delete>
	
	<delete id="deleteBatchExhibitOffshop" parameterType="dmsExhibit">
		/* [dms.exhibit.deleteBatchExhibitOffshop][allen][2016.08.01] */
		DELETE 
		  FROM DMS_EXHIBITOFFSHOP 
		 WHERE STORE_ID = #{storeId}
		   AND EXHIBIT_ID = #{exhibitId} 
	</delete>
	
	<delete id="deleteExhibitBrand" parameterType="dmsExhibit">
		/* [dms.exhibit.deleteExhibitBrand][allen][2016.06.07] */
		DELETE 
		  FROM DMS_EXHIBITBRAND 
		 WHERE STORE_ID = #{storeId}
		   AND EXHIBIT_ID = #{exhibitId} 
	</delete>
	
	<delete id="deleteExhibitDisplayCategory" parameterType="dmsExhibit">
		/* [dms.exhibit.deleteExhibitDisplayCategory][allen][2016.06.07] */
		DELETE 
		  FROM DMS_EXHIBITDISPLAYCATEGORY 
		 WHERE STORE_ID = #{storeId}
		   AND EXHIBIT_ID = #{exhibitId} 
	</delete>
	
	<insert id="insertDmsExhibitproduct" parameterType="dmsExhibitproduct">
		INSERT INTO 
		DMS_EXHIBITPRODUCT (
   							  STORE_ID
   							, EXHIBIT_ID
   							, GROUP_NO
   							, PRODUCT_ID
   							, DISPLAY_YN
   							, SORT_NO
   							, INS_DT
   							, INS_ID
   							, UPD_DT
   							, UPD_ID) 
					VALUES (  #{storeId}
							, #{exhibitId}
					 		, #{groupNo, jdbcType=INTEGER}
					 		, #{productId}
					 		, #{displayYn}
							, #{sortNo, jdbcType=INTEGER}
					 		, SYSDATE
					 		, #{insId}
					 		, SYSDATE
					 		, #{updId}
					 		)
	</insert>
	
	<update id="updateExhibitStatus">
		UPDATE DMS_EXHIBIT
		   SET 
       			  EXHIBIT_STATE_CD = #{exhibitStateCd}
       			, UPD_DT           = SYSDATE
       			, UPD_ID           = #{updId}
		 WHERE STORE_ID = #{storeId}
		   AND EXHIBIT_ID = #{exhibitId}
	</update>
	<select id="getProductExhibitList" resultType="DmsExhibit">
	/* [dms.exhibit.getProductExhibitList][eddie][2016.06.07] */
		SELECT EXH.*
		  FROM DMS_EXHIBIT EXH
		 WHERE     EXH.DISPLAY_YN = 'Y'
		       AND EXH.EXHIBIT_STATE_CD = 'EXHIBIT_STATE_CD.RUN'
		       AND SYSDATE BETWEEN EXH.START_DT AND EXH.END_DT
		       AND EXH.STORE_ID = #{storeId}
		       AND 1 = CASE WHEN EXH.EXHIBIT_TYPE_CD != 'EXHIBIT_TYPE_CD.ONDAY'  
	                             THEN( SELECT 1 
	                                     FROM DMS_EXHIBIT  
	                                    WHERE EXHIBIT_ID = EXH.EXHIBIT_ID 
	                                      AND DAYS_WEEK LIKE '%' || to_char(SYSDATE,'d') || '%') 
	                             ELSE 1 
	                             END
		       AND CASE
		              WHEN EXHIBIT_TYPE_CD = 'EXHIBIT_TYPE_CD.ONEDAY'
		              THEN
		                  (SELECT (SELECT count(1)
		                    FROM DMS_EXHIBITMAINPRODUCT EXMP
		                   WHERE     EXMP.EXHIBIT_ID = EXH.EXHIBIT_ID
		                         AND EXMP.STORE_ID = EXH.STORE_ID
		                         AND EXMP.PRODUCT_ID = #{productId})
		                  + 
		                  (SELECT count(1)
		                    FROM DMS_EXHIBITGROUP GP
		                         INNER JOIN
		                            DMS_EXHIBITPRODUCT PRD
		                         ON     GP.EXHIBIT_ID = PRD.EXHIBIT_ID
		                            AND GP.GROUP_NO = PRD.GROUP_NO
		                            AND GP.STORE_ID = PRD.STORE_ID
		                            AND PRD.DISPLAY_YN = 'Y'
		                            AND PRD.PRODUCT_ID = #{productId}
		                   WHERE     GP.EXHIBIT_ID = EXH.EXHIBIT_ID
		                         AND EXH.STORE_ID = GP.STORE_ID
		                         AND GP.DISPLAY_YN = 'Y') FROM DUAL)
		              ELSE
		                 (SELECT count(1)
		                    FROM    DMS_EXHIBITGROUP GP
		                         INNER JOIN
		                            DMS_EXHIBITPRODUCT PRD
		                         ON     GP.EXHIBIT_ID = PRD.EXHIBIT_ID
		                            AND GP.GROUP_NO = PRD.GROUP_NO
		                            AND GP.STORE_ID = PRD.STORE_ID
		                            AND PRD.DISPLAY_YN = 'Y'
		                            AND PRD.PRODUCT_ID = #{productId}
		                   WHERE     GP.EXHIBIT_ID = EXH.EXHIBIT_ID
		                         AND EXH.STORE_ID = GP.STORE_ID
		                         AND GP.DISPLAY_YN = 'Y')
		           END > 0		       
	</select>
	
	<resultMap type="dmsExhibitoffshop" id="getExhibitoffshopResult" autoMapping="true">
		<id property="exhibitId" column="EXHIBIT_ID" />
		<association property="dmsExhibit" javaType="dmsExhibit">
			<id property="exhibitId" column="EXHIBIT_ID" />
			<result property="name" column="NAME" />
			<result property="img1" column="IMG1" />
			<result property="img2" column="IMG2" />
		</association>
	</resultMap>
	<select id="getExhibitoffshopInfo" resultMap="getExhibitoffshopResult">
		/* [dms.exhibit.getExhibitoffshopInfo][stella][2016.09.22] */
		SELECT
			EO.EXHIBIT_ID
			, E.NAME
			, E.IMG1
			, E.IMG2
		  FROM
		  	DMS_EXHIBITOFFSHOP EO
		 	JOIN DMS_EXHIBIT E
		 		ON E.STORE_ID = EO.STORE_ID
		 		AND E.EXHIBIT_ID = EO.EXHIBIT_ID
		 		AND E.DISPLAY_YN = 'Y'
		 		AND E.EXHIBIT_TYPE_CD = 'EXHIBIT_TYPE_CD.OFFSHOP'
		 		AND E.EXHIBIT_STATE_CD = 'EXHIBIT_STATE_CD.RUN'
                AND SYSDATE BETWEEN E.START_DT AND E.END_DT
         WHERE
         	EO.STORE_ID = #{storeId}
         	AND EO.OFFSHOP_ID = #{offshopId}
         ORDER BY
         	E.INS_DT DESC
	</select>
	
	
	<select id="getExhibitBrandList" resultType="pmsBrand">
	/* [dms.exhibit.getExhibitBrandList][allen][2016.09.22] */
		 SELECT * 
		   FROM (
		         SELECT 
		                  T1.BRAND_ID
		                , T1.NAME
		                , T4.SORT_NO
		            FROM PMS_BRAND T1 
		            JOIN DMS_EXHIBITBRAND T2
		            ON T1.BRAND_ID = T2.BRAND_ID
		          LEFT JOIN DMS_EXHIBIT T3
		            ON T2.EXHIBIT_ID = T3.EXHIBIT_ID
		            LEFT JOIN CCS_CODE T4
		            ON T1.BRAND_ID = T4.CD
		          WHERE SYSDATE BETWEEN T3.START_DT AND T3.END_DT
		            AND T3.EXHIBIT_STATE_CD = 'EXHIBIT_STATE_CD.RUN'
		            AND T3.DISPLAY_YN = 'Y'
		            AND 1 = CASE WHEN T3.EXHIBIT_TYPE_CD != 'EXHIBIT_TYPE_CD.ONDAY'  
	                             THEN( SELECT 1 
	                                     FROM DMS_EXHIBIT  
	                                    WHERE EXHIBIT_ID = T3.EXHIBIT_ID 
	                                      AND DAYS_WEEK LIKE '%' || to_char(SYSDATE,'d') || '%') 
	                             ELSE 1 
	                             END
		           GROUP BY T1.BRAND_ID, T1.NAME , T4.SORT_NO
			    ) result
          ORDER BY result.SORT_NO
	</select>
	
	<resultMap type="DmsExhibit" id="mainExhibitMap" autoMapping="true">
		<id property="exhibitId" column="EXHIBIT_ID" />
		<result property="brandId" column="BRAND_ID" />
		<association property="dmsExhibitcoupons" resultMap="dmsExhibitcouponMap">
		
		</association>	
	</resultMap>
	
	
	<resultMap type="dmsExhibitcoupon" id="dmsExhibitcouponMap" autoMapping="true">
		<id property="storeId" column="STORE_ID" />
		<id property="exhibitId" column="EXHIBIT_ID" />
		<id property="couponId" column="COUPON_ID" />
		<association property="spsCoupon" column="COUPON_ID" javaType="spsCoupon">
			<id property="couponId" column="COUPON_ID" />
			<result property="name" column="COUPON_NAME" />
			<result property="dcValue" column="DC_VALUE" />
			<result property="dcApplyTypeCd" column="DC_APPLY_TYPE_CD" />
			<result property="couponTypeCd" column="COUPON_TYPE_CD" />
			<result property="maxMemIssueQty" column="MAX_MEM_ISSUE_QTY" />
			<result property="minOrderAmt" column="MIN_ORDER_AMT" />
			<result property="termTypeCd" column="TERM_TYPE_CD" />
			<result property="termDays" column="TERM_DAYS" />
			<result property="termStartDt" column="TERM_START_DT" />
			<result property="termEndDt" column="TERM_END_DT" />
			<result property="issueStartDt" column="ISSUE_START_DT" />
			<result property="issueEndDt" column="ISSUE_END_DT" />
			<result property="couponIssueTypeCd" column="COUPON_ISSUE_TYPE_CD" />
			<result property="maxIssueQty" column="MAX_ISSUE_QTY" />
			<result property="couponStateCd" column="COUPON_STATE_CD" />
			<result property="downShowYn" column="DOWN_SHOW_YN" />
			<result property="maxDcAmt" column="MAX_DC_AMT" />
			<result property="discountDupYn" column="DISCOUNT_DUP_YN" />
			<result property="controlNo" column="CONTROL_NO" />
			<result property="applyNo" column="APPLY_NO" />
			<result property="businessId" column="BUSINESS_ID" />
			<result property="businessBurdenRate" column="BUSINESS_BURDEN_RATE" />
			<result property="feeLimitApplyYn" column="FEE_LIMIT_APPLY_YN" />
			<result property="affiliateYn" column="AFFILIATE_YN" />
			<result property="dealApplyYn" column="DEAL_APPLY_YN" />
			<result property="campaignYn" column="CAMPAIGN_YN" />
			<result property="memIssueBasisCd" column="MEM_ISSUE_BASIS_CD" />
			<result property="targetTypeCd" column="TARGET_TYPE_CD" />
		</association>
	</resultMap>
	
	<select id="getMainExhibitList" resultMap="mainExhibitMap">
		/* [dms.exhibit.getMainExhibitList][allen][2016.09.22] */
		<include refid="ccs.common.pagingPre" />
		SELECT 
				  T1.STORE_ID
				, T1.EXHIBIT_ID
				, T1.NAME
				, T1.SUBTITLE
				, T1.EXHIBIT_TYPE_CD
				, T1.CONTROL_NO
				, T1.START_DT
				, T1.END_DT
				, T1.DAYS_WEEK
				, T1.IMG1
				, T1.IMG2
				, T1.TEXT1
				, T1.TEXT2
				, T1.HTML1
				, T1.HTML2
				, T1.EXHIBIT_STATE_CD
				, T1.DISPLAY_YN
				, T1.SORT_NO
				, T1.INS_DT
				, T1.INS_ID
				, T1.UPD_DT
				, T1.UPD_ID
				, CASE (SELECT COUNT(*) 
						  FROM DMS_EXHIBITBRAND 
						 WHERE EXHIBIT_ID = T1.EXHIBIT_ID) WHEN 1 THEN (SELECT BRAND_ID 
						 												  FROM DMS_EXHIBITBRAND 
						 												 WHERE EXHIBIT_ID = T1.EXHIBIT_ID)
                                                           ELSE ''
                                                            END AS BRAND_ID
                , T3.COUPON_ID
                , T4.DC_VALUE
                , T4.DC_APPLY_TYPE_CD
                , T4.COUPON_TYPE_CD
  		  FROM DMS_EXHIBIT T1
  		  LEFT JOIN DMS_EXHIBITCOUPON T3
  		        ON T1.EXHIBIT_ID = T3.EXHIBIT_ID
  		       AND T1.STORE_ID = T3.STORE_ID AND T1.STORE_ID = #{storeId}
		  LEFT JOIN SPS_COUPON T4
		        ON T3.COUPON_ID = T4.COUPON_ID
		       AND T3.STORE_ID = T4.STORE_ID AND T4.STORE_ID = #{storeId} 
			AND SYSDATE BETWEEN T4.ISSUE_START_DT AND T4.ISSUE_END_DT
		    AND T4.COUPON_STATE_CD = 'COUPON_STATE_CD.RUN'
  		  <if test="brandId != null and brandId != ''">
  		  JOIN DMS_EXHIBITBRAND T2
  		    ON T1.EXHIBIT_ID = T2.EXHIBIT_ID
		    AND T2.BRAND_ID = #{brandId}   		  
  		  </if>
		  WHERE SYSDATE BETWEEN T1.START_DT AND T1.END_DT
		    AND T1.EXHIBIT_STATE_CD = 'EXHIBIT_STATE_CD.RUN'
			AND T1.DISPLAY_YN = 'Y'
			<if test="mobileYn != null and mobileYn eq 'N'.toString()">
			 	AND T1.IMG1 IS NOT NULL
			</if>
			<if test="mobileYn != null and mobileYn eq 'Y'.toString()">
			 	AND T1.IMG2 IS NOT NULL
			</if> 
			AND 1 = CASE WHEN T1.EXHIBIT_TYPE_CD != 'EXHIBIT_TYPE_CD.ONDAY'  
	                             THEN( SELECT 1 
	                                     FROM DMS_EXHIBIT  
	                                    WHERE EXHIBIT_ID = T1.EXHIBIT_ID 
	                                      AND DAYS_WEEK LIKE '%' || to_char(SYSDATE,'d') || '%') 
	                             ELSE 1 
	                             END
		  <if test="displayCategoryId != null and displayCategoryId != ''">
		  	AND T1.EXHIBIT_ID IN 
		  						( SELECT EXHIBIT_ID 
		  						    FROM (
											SELECT T1.DISPLAY_CATEGORY_ID
											  FROM DMS_DISPLAYCATEGORY T1
											START WITH T1.DISPLAY_CATEGORY_ID = #{displayCategoryId}
											  CONNECT BY PRIOR  T1.DISPLAY_CATEGORY_ID = T1.UPPER_DISPLAY_CATEGORY_ID
										  ) A JOIN  
										 ( SELECT T2.DISPLAY_CATEGORY_ID, T2.EXHIBIT_ID
										  FROM DMS_EXHIBITDISPLAYCATEGORY T2
										 ) B
										ON A.DISPLAY_CATEGORY_ID = B.DISPLAY_CATEGORY_ID )
		  </if>
		   <if test="exhibitIdList != null and exhibitIdList.size() > 0">
	           AND T1.EXHIBIT_ID NOT IN 
	           <foreach collection="exhibitIdList" item="exhibitId" open="(" separator=","  close=")">
	           		#{exhibitId}
	           </foreach>
           </if>
	
		      ORDER BY T1.SORT_NO, T1.START_DT DESC, T1.INS_DT DESC, T1.END_DT ASC
		<include refid="ccs.common.pagingPost" />
	</select>
	
	
	
	<resultMap type="dmsExhibit" id="frontExhibitDetailMap" autoMapping="true">
		<id property="exhibitId" column="EXHIBIT_ID" />
		<collection property="dmsExhibitgroups" ofType="gcp.dms.model.DmsExhibitgroup">
			<id property="storeId" column="STORE_ID" />
			<id property="exhibitId" column="EXHIBIT_ID" />
			<id property="groupNo" column="GROUP_NO" />
			<result property="name" column="GROUP_NAME" />
			<result property="groupTypeCd" column="GROUP_TYPE_CD" />
			<result property="sortNo" column="SORT_NO" />
			<result property="img" column="IMG" />
			<result property="url1" column="URL1" />
			<result property="url2" column="URL2" />
			<result property="productDisplayType1Cd" column="PRODUCT_DISPLAY_TYPE1_CD" />
			<result property="productDisplayType2Cd" column="PRODUCT_DISPLAY_TYPE2_CD" />
			<result property="groupProductCount" column="GROUP_PRODUCT_COUNT" />
			<collection property="dmsExhibitproducts" ofType="gcp.dms.model.DmsExhibitproduct">
				<id property="groupNo" column="GROUP_NO" />
				<id property="productId" column="PRODUCT_ID" />
				<result property="rowNumber" column="ROW_NUMBER" />
				<association property="pmsProduct" column="PRODUCT_ID" javaType="pmsProduct">
					<id property="productId" column="PRODUCT_ID" />
					<id property="salePrice" column="PRODUCT_SALE_PRICE" />
					<id property="name" column="PRODUCT_NAME" />
					<id property="saleStateCd" column="SALE_STATE_CD" />
					<association property="pmsProductprice" column="PRODUCT_ID" javaType="pmsProductprice">
						<id property="productId" 					column="PRODUCT_ID" />
						<result property="salePrice"				column="SALE_PRICE" />
						<result property="pointYn" 					column="POINT_YN" />
						<result property="deliveryFeeFreeYn" 		column="DELIVERY_FEE_FREE_YN" />
						<result property="couponId" 				column="COUPON_ID" />
						<result property="prestigeSalePrice"		column="PRESTIGE_SALE_PRICE" />
						<result property="prestigePointYn"			column="PRESTIGE_POINT_YN" />
						<result property="prestigeDeliveryFeeFreeYn" column="PRESTIGE_DELIVERY_FEE_FREE_YN" />
						<result property="prestigeCouponId"			column="PRESTIGE_COUPON_ID" />
						<result property="vipSalePrice"				column="VIP_SALE_PRICE" />
						<result property="vipPointYn" 				column="VIP_POINT_YN" /> 
						<result property="vipDeliveryFeeFreeYn" 	column="VIP_DELIVERY_FEE_FREE_YN" />
						<result property="vipCouponId" 				column="VIP_COUPON_ID" />
						<result property="goldSalePrice"			column="GOLD_SALE_PRICE" />
						<result property="goldPointYn" 				column="GOLD_POINT_YN" />
						<result property="goldDeliveryFeeFreeYn"	column="GOLD_DELIVERY_FEE_FREE_YN" />
						<result property="goldCouponId"				column="GOLD_COUPON_ID" />
						<result property="silverSalePrice"			column="SILVER_SALE_PRICE" />
						<result property="silverPointYn"			column="SILVER_POINT_YN" />
						<result property="silverDeliveryFeeFreeYn"	column="SILVER_DELIVERY_FEE_FREE_YN" />
						<result property="silverCouponId"			column="SILVER_COUPON_ID" />
						<result property="familySalePrice"			column="FAMILY_SALE_PRICE" />
						<result property="familyPointYn"			column="FAMILY_POINT_YN" />
						<result property="familyDeliveryFeeFreeYn"	column="FAMILY_DELIVERY_FEE_FREE_YN" />
						<result property="familyCouponId"			column="FAMILY_COUPON_ID" />
						<result property="welcomeSalePrice" 		column="WELCOME_SALE_PRICE" />
						<result property="welcomePointYn" 			column="WELCOME_POINT_YN" />
						<result property="welcomeDeliveryFeeFreeYn" column="WELCOME_DELIVERY_FEE_FREE_YN" />
						<result property="welcomeCouponId" 			column="WELCOME_COUPON_ID" />
					</association>	
				</association>
			</collection> 
		</collection>
	</resultMap>
	
	
	
	<select id="getFrontExhibitInfo" resultMap="frontExhibitDetailMap">
		/* [dms.exhibit.getFrontExhibitInfo][allen][2016.09.26] */
		SELECT 
				  T1.EXHIBIT_ID
                , T1.NAME
                , T1.EXHIBIT_TYPE_CD
                , T1.START_DT
                , T1.END_DT
                , T1.STORE_ID
                , T1.EXHIBIT_STATE_CD
                , T1.DISPLAY_YN
                , T1.SORT_NO
                , T1.CONTROL_NO
                , T1.IMG1
                , T1.IMG2
                , T1.HTML1
                , T1.HTML2
                , T1.SUB_HTML1
                , T1.SUB_HTML2
                , T1.TEXT1
                , T1.TEXT2
                , T1.DAYS_WEEK
                , T1.SUBTITLE
                , T2.GROUP_NO AS GROUP_NO
                , T2.NAME AS GROUP_NAME
                , T2.IMG
                , T2.URL1
                , T2.URL2
                , T2.GROUP_TYPE_CD
             FROM DMS_EXHIBIT T1
             LEFT JOIN DMS_EXHIBITGROUP T2
               ON T1.EXHIBIT_ID = T2.EXHIBIT_ID
             WHERE T1.STORE_ID = #{storeId}
              AND T1.EXHIBIT_ID = #{exhibitId}
              AND T1.EXHIBIT_STATE_CD = 'EXHIBIT_STATE_CD.RUN'
              AND SYSDATE BETWEEN T1.START_DT AND T1.END_DT
	</select>
	
	
	<select id="getFrontExhibitDetail" resultMap="frontExhibitDetailMap">
		/* [dms.exhibit.getFrontExhibitDetail][allen][2016.09.26] */
		<include refid="ccs.common.pagingPre" />
		SELECT 
				  ROW_NUMBER() OVER (PARTITION BY T3.GROUP_NO ORDER BY T2.SORT_NO, T3.SORT_NO ) AS ROW_NUMBER
				, T1.EXHIBIT_ID
                , T1.NAME
                , T1.EXHIBIT_TYPE_CD
                , T1.START_DT
                , T1.END_DT
                , T1.STORE_ID
                , T1.EXHIBIT_STATE_CD
                , T1.DISPLAY_YN
                , T1.SORT_NO
                , T1.CONTROL_NO
                , T1.IMG1
                , T1.IMG2
                , T1.HTML1
                , T1.HTML2
                , T1.SUB_HTML1
                , T1.SUB_HTML2
                , T1.TEXT1
                , T1.TEXT2
                , T1.DAYS_WEEK
                , T1.SUBTITLE
                , T2.GROUP_NO
                , T2.NAME        				AS GROUP_NAME
                , T2.GROUP_TYPE_CD
                , T2.SORT_NO AS GROUP_SORT_NO
                , T2.DISPLAY_YN					AS GROUP_DISPLAY_YN
                , T2.IMG
                , T2.URL1
                , T2.PRODUCT_DISPLAY_TYPE1_CD
                , T2.PRODUCT_DISPLAY_TYPE2_CD
                , T2.URL2
                , T3.GROUP_NO 					AS PRODUCT_GROUP_NO
                , T3.PRODUCT_ID					
                , T3.SORT_NO 					AS PRODUCT_SORT_NO
                , T3.DISPLAY_YN					AS PRODUCT_DISPLAY_YN
                , T4.NAME						AS PRODUCT_NAME
                , T4.SALE_PRICE					AS PRODUCT_SALE_PRICE
                , T4.SALE_STATE_CD				
				, T7.SALE_PRICE       			
				, T7.POINT_YN                     
				, T7.DELIVERY_FEE_FREE_YN         
				, T7.COUPON_ID                    
				, T7.PRESTIGE_SALE_PRICE          
				, T7.PRESTIGE_POINT_YN            
				, T7.PRESTIGE_DELIVERY_FEE_FREE_YN
				, T7.PRESTIGE_COUPON_ID           
				, T7.VIP_SALE_PRICE
				, T7.VIP_POINT_YN
				, T7.VIP_DELIVERY_FEE_FREE_YN
				, T7.VIP_COUPON_ID
				, T7.GOLD_SALE_PRICE
				, T7.GOLD_POINT_YN
				, T7.GOLD_DELIVERY_FEE_FREE_YN
				, T7.GOLD_COUPON_ID
				, T7.SILVER_SALE_PRICE
				, T7.SILVER_POINT_YN
				, T7.SILVER_DELIVERY_FEE_FREE_YN
				, T7.SILVER_COUPON_ID
				, T7.FAMILY_SALE_PRICE
				, T7.FAMILY_POINT_YN
				, T7.FAMILY_DELIVERY_FEE_FREE_YN
				, T7.FAMILY_COUPON_ID
				, T7.WELCOME_SALE_PRICE
				, T7.WELCOME_POINT_YN
				, T7.WELCOME_DELIVERY_FEE_FREE_YN
				, T7.WELCOME_COUPON_ID
				, COUNT(*) OVER (PARTITION BY T2.GROUP_NO) AS GROUP_PRODUCT_COUNT
             FROM DMS_EXHIBIT T1 
             LEFT JOIN DMS_EXHIBITGROUP T2
               ON T1.EXHIBIT_ID = T2.EXHIBIT_ID
               AND T2.DISPLAY_YN = 'Y'
               AND T1.STORE_ID = #{storeId}
               AND T2.STORE_ID = #{storeId}
             JOIN DMS_EXHIBITPRODUCT T3
               ON T1.EXHIBIT_ID = T3.EXHIBIT_ID
              AND T2.GROUP_NO = T3.GROUP_NO
              AND T3.STORE_ID = #{storeId}
             JOIN PMS_PRODUCT T4
               ON T3.PRODUCT_ID = T4.PRODUCT_ID
              AND SYSDATE BETWEEN T4.SALE_START_DT AND T4.SALE_END_DT
			  AND T4.SALE_STATE_CD = 'SALE_STATE_CD.SALE'
			  AND T4.STORE_ID = #{storeId}
             JOIN PMS_PRODUCTPRICE T7
               ON T3.PRODUCT_ID = T7.PRODUCT_ID
              AND T7.STORE_ID = #{storeId}
            WHERE T1.EXHIBIT_ID = #{exhibitId}
              AND T1.EXHIBIT_STATE_CD = 'EXHIBIT_STATE_CD.RUN'
              AND SYSDATE BETWEEN T1.START_DT AND T1.END_DT
            <if test="groupNo != null and groupNo != ''">
             AND T2.GROUP_NO = #{groupNo}
            </if>
            ORDER BY T2.SORT_NO, T3.SORT_NO , ROW_NUMBER
            <include refid="ccs.common.pagingPost" />
	</select>
	
	
	<resultMap type="dmsExhibit" id="getCategoryExhibit" autoMapping="true">
		<result property="displayCategoryId" column="DISPLAY_CATEGORY_ID"/>
	</resultMap>
	<select id="getCategoryExhibit" resultMap="getCategoryExhibit">
		SELECT CA.DISPLAY_CATEGORY_ID, 
		        EX.*
		FROM DMS_DISPLAYCATEGORY CA,
		DMS_EXHIBITDISPLAYCATEGORY EC,
		DMS_EXHIBIT EX
		WHERE CA.STORE_ID = EC.STORE_ID 
		AND CA.DISPLAY_CATEGORY_ID = EC.DISPLAY_CATEGORY_ID
		AND EC.STORE_ID = EX.STORE_ID
		AND EC.EXHIBIT_ID = EX.EXHIBIT_ID
		<if test="displayCategoryId != null and displayCategoryId !=''">
			AND CA.DISPLAY_CATEGORY_ID = ${displayCategoryId}
		</if>
		AND EX.START_DT <![CDATA[<=]]> SYSDATE
		AND EX.END_DT <![CDATA[>=]]> SYSDATE   
		AND EX.DISPLAY_YN = 'Y'
		AND EX.EXHIBIT_STATE_CD = 'EXHIBIT_STATE_CD.RUN'
		ORDER BY EX.SORT_NO
	</select>
	
	<select id="getBrandExhibitInfo" resultType="DmsExhibit">
		/* [dms.exhibit.getBrandExhibitInfo][stella][2016.09.30] */
		SELECT
			E.*
		  FROM
		  	DMS_EXHIBIT E
		  	JOIN DMS_EXHIBITBRAND EB
		  		ON E.STORE_ID = EB.STORE_ID
		  		AND E.EXHIBIT_ID = EB.EXHIBIT_ID
		  		AND EB.BRAND_ID = #{brandId}
		 WHERE
		 	E.STORE_ID = #{storeId}
		 	AND (E.START_DT <![CDATA[<=]]> SYSDATE AND END_DT <![CDATA[>=]]> SYSDATE)
		 	AND E.DISPLAY_YN = 'Y'
		 	AND E.EXHIBIT_STATE_CD = 'EXHIBIT_STATE_CD.RUN'
		 ORDER BY
		 	E.START_DT DESC, E.INS_DT DESC
	</select>
	
	<select id="getOffshopExhibitList" resultType="dmsExhibit">
		SELECT * 
		  FROM (     
				SELECT result.* , ROW_NUMBER() OVER(ORDER BY '') RNUM2 FROM (
				    
				     SELECT
				               ROW_NUMBER() OVER(PARTITION BY E.EXHIBIT_ID ORDER BY  '') RNUM
				            ,  E.EXHIBIT_ID
				            , E.NAME
				            , E.IMG1
				            , E.IMG2
				            , E.START_DT
				          FROM DMS_EXHIBIT E
				          JOIN DMS_EXHIBITOFFSHOP EO 
				            ON E.EXHIBIT_ID = EO.EXHIBIT_ID
				         WHERE EO.STORE_ID = #{storeId}
				           AND E.EXHIBIT_TYPE_CD = 'EXHIBIT_TYPE_CD.OFFSHOP'
				           AND E.EXHIBIT_STATE_CD = 'EXHIBIT_STATE_CD.RUN'
				           AND SYSDATE BETWEEN E.START_DT AND E.END_DT
				) result
				WHERE RNUM = 1
				ORDER BY START_DT DESC
			) WHERE RNUM2 &lt; 6
	</select>
	
	<select id="getRecommendExhibit" resultType="dmsExhibit">
		/*[dms.exhibit.getRecommendExhibit][emily][2016. 11. 01.]*/
		SELECT * 
		FROM DMS_EXHIBIT
		WHERE DISPLAY_YN = 'Y'
		AND START_DT <![CDATA[<=]]> SYSDATE 
		AND END_DT <![CDATA[>=]]> SYSDATE
		AND NAME LIKE #{searchKeyword} ||'%'
	</select>	
</mapper>